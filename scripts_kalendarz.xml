<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE MudletPackage>
<MudletPackage version="1.001">
	<ScriptPackage>
		<Script isActive="yes" isFolder="no">
			<name>kalendarz</name>
			<packageName></packageName>
			<script>kalendarz_imp_miesiac_dig = {
  ["Nachhexen"] = 1,
  ["Jahrdrung"] = 2,
  ["Pflugzeit"] = 3,
  ["Sigmarszeit"] = 4,
  ["Sommerzeit"] = 5,
  ["Vorgeheim"] = 6,
  ["Nachgeheim"] = 7,
  ["Erntezeit"] = 8,
  ["Brauzeit"] = 9,
  ["Kaltezeit"] = 10,
  ["Ulrichszeit"] = 11,
  ["Vorhexen"] = 12,
}

kalendarz_ish_miesiac_dig = {
  ["Saovine"] = 1,
  ["Yule"] = 2,
  ["Imbaelk"] = 3,
  ["Birke"] = 4,
  ["Blathe"] = 5,
  ["Feainn"] = 6,
  ["Lammas"] = 7,
  ["Velen"] = 8,
}

kalendarz_imp_miesiac_txt = {"Nachhexen", "Jahrdrung", "Pflugzeit", "Sigmarszeit", "Sommerzeit", "Vorgeheim", "Nachgeheim", "Erntezeit", "Brauzeit", "Kaltezeit", "Ulrichszeit", "Vorhexen"}

kalendarz_ish_miesiac_txt = {"Saovine", "Yule", "Imbaelk", "Birke", "Blathe", "Feainn", "Lammas", "Velen"}

kalendarz_imp_dlugosc_miesiaca = {32, 33, 33, 33, 33, 33, 32, 33, 33, 33, 33, 33}

kalendarz_imp_delta_dni = {0, 33, 67, 100, 133, 167, 201, 233, 267, 300, 333, 367}

kalendarz_ish_delta_dni = {0, 45, 90, 135, 180, 225, 270, 315}

kalendarz_ish_festyn = {6, 51, 96, 141, 186, 231, 276, 321}

kalendarz_imp_now = {14, 39, 64, 89, 114, 139, 164, 189, 214, 239, 264, 289, 314, 339, 364, 389}

kalendarz_imp_zachod = {17, 18, 18, 19, 20, 21, 21, 22, 21, 20, 20, 19, 18, 17, 17, 16}

kalendarz_imp_pelnia = {26, 51, 76, 102, 126, 151, 176, 227, 251, 276, 326, 351, 376}

kalendarz_ish_pelnia = {1, 26, 51, 76, 101, 126, 151, 176, 201, 226, 251, 276, 300, 326, 351}

kalendarz_imp_swieta = {1, 67, 167, 201, 267, 367}

kalendarz_imp_swieta_nazwy = {"Hexentag (Nowy Rok, Noc Czarownic - Morr)", "Mitterfruhl (Wiosenna Rownonoc, Rozkwitanie - Taal, Ulryk, Mannan)", "Sonnenstill (Letnie Przesilenie, Dzien Slonca - Taal, Rhya)", "Geheimnisnacht (Noc Tajemnicy - Morr)", "Mitterherbst (Jesienna Rownonoc, Przekwitanie - Ulryk, Taal, Rhya)", "Mondstill (Zimowe Przesilenie, Uspienie - Ulryk, Taal, Rhya)"}

kalendarz_imp_swieta_nazwydni = {"dzien Hexentag", "dzien Mitterfruhl", "dzien Sonnenstill", "dzien Geheimnisnacht", "dzien Mitterherbst", "dzien Mondstill"}

kalendarz_ish_swieta = {1, 46, 91, 136, 181, 226, 271, 316}

kalendarz_ish_swieta_nazwy = {"Dzien Zamierania", "Solstycjum Zimowe", "Dzien Kielkowania", "Ekwinokcjum Wiosenne", "Dzien Rozkwitania", "Solstycjum Letnie", "Dzien Dojrzewania", "Ekwinokcjum Jesienne"} 

kalendarz_imp_dni_liczebniki = {
  "pierwszy dzien",
  "drugi dzien",
  "trzeci dzien",
  "czwarty dzien",
  "piaty dzien",
  "szosty dzien",
  "siodmy dzien",
  "osmy dzien",
  "dziewiaty dzien",
  "dziesiaty dzien",
  "jedenasty dzien",
  "dwunasty dzien",
  "trzynasty dzien",
  "czternasty dzien",
  "pietnasty dzien",
  "szesnasty dzien",
  "siedemnasty dzien",
  "osiemnasty dzien",
  "dziewietnasty dzien",
  "dwudziesty dzien",
  "dwudziesty pierwszy dzien",
  "dwudziesty drugi dzien",
  "dwudziesty trzeci dzien",
  "dwudziesty czwarty dzien",
  "dwudziesty piaty dzien",
  "dwudziesty szosty dzien",
  "dwudziesty siodmy dzien",
  "dwudziesty osmy dzien",
  "dwudziesty dziewiaty dzien",
  "trzydziesty dzien",
  "trzydziesty pierwszy dzien",
  "trzydziesty drugi dzien",
  "trzydziesty trzeci dzien",
}

kalendarz_ish_dni_liczebniki = {
  "pierwszy dzien",
  "drugi dzien",
  "trzeci dzien",
  "czwarty dzien",
  "piaty dzien",
  "szosty dzien",
  "siodmy dzien",
  "osmy dzien",
  "dziewiaty dzien",
  "dziesiaty dzien",
  "jedenasty dzien",
  "dwunasty dzien",
  "trzynasty dzien",
  "czternasty dzien",
  "pietnasty dzien",
  "szesnasty dzien",
  "siedemnasty dzien",
  "osiemnasty dzien",
  "dziewietnasty dzien",
  "dwudziesty dzien",
  "dwudziesty pierwszy dzien",
  "dwudziesty drugi dzien",
  "dwudziesty trzeci dzien",
  "dwudziesty czwarty dzien",
  "dwudziesty piaty dzien",
  "dwudziesty szosty dzien",
  "dwudziesty siodmy dzien",
  "dwudziesty osmy dzien",
  "dwudziesty dziewiaty dzien",
  "trzydziesty dzien",
  "trzydziesty pierwszy dzien",
  "trzydziesty drugi dzien",
  "trzydziesty trzeci dzien",
  "trzydziesty czwarty dzien",
  "trzydziesty piaty dzien",
  "trzydziesty szosty dzien",
  "trzydziesty siodmy dzien",
  "trzydziesty osmy dzien",
  "trzydziesty dziewiaty dzien",
  "czterdziesty dzien",
  "czterdziesty pierwszy dzien",
  "czterdziesty drugi dzien",
  "czterdziesty trzeci dzien",
  "czterdziesty czwarty dzien",
  "czterdziesty piaty dzien", 
}

kalendarz_godzina = {
  "pierwsza",
  "druga",
  "trzecia",
  "czwarta",
  "piata",
  "szosta",
  "siodma",
  "osma",
  "dziewiata",
  "dziesiata",
  "jedenasta",
  "dwunasta",
}

kalendarz_am = {
  "nad ranem",
  "przed poludniem",
  "rano",
  "w poludnie",
  "w przyblizeniu polnoc",
}

kalendarz_pm = {
  "po poludniu",
  "wieczorem",
  "przed polnoca",
  "w nocy",
  "w przyblizeniu poludnie",
} 
  
function convert_time(time)
  
  local znak = ''
  
  if time &lt; 0 then
    znak = '-'
  end
  
  time = math.abs(time)
  
  local hours = math.floor(time/3600)
  local remaining = time % 3600
  local minutes = math.floor(remaining/60)
  local answer = znak.. hours..' godzin '..minutes..' minut'
  return answer
end

function predykcje_astro_imp()

local czas, delta, now_delta, pelnia_delta, swieto_delta
local dzien, miesiac, godzina, am_pm, zachod
local now, pelnia, swieto, swieto_nazwa
local am_pm_fix = 0
local poludnie_fix = 0

miesiac = 3
for i=1,12,1 do
  if string.find(kalendarz_astro, kalendarz_imp_miesiac_txt[i]) then
    miesiac = i
    break
  end
end

for i=1,5,1 do
  if string.find(kalendarz_astro, kalendarz_am[i]) then
    am_pm = 0
    break
  end
end

if string.find(kalendarz_astro, kalendarz_am[5]) then
  godzina = 0
end

for i=1,5,1 do
  if string.find(kalendarz_astro, kalendarz_pm[i]) then
    am_pm = 1
    if i == 4 then am_pm_fix = 1 end
    if i == 5 then
      poludnie_fix = 1
      godzina = 12
      break
    end
    break
  end
end

for i=1,12,1 do
  if string.find(kalendarz_astro, kalendarz_godzina[i]) then
    godzina = i
    break
  end
end

delta = 0

if am_pm == 0 then delta = godzina*120 end
if am_pm == 1 then delta = (godzina+12)*120 end

if am_pm == 1 and godzina == 12 then delta = 0 end
if am_pm == 1 and godzina == 12 and poludnie_fix == 1 then delta = (12*120) end
if am_pm == 1 and godzina == 1 and am_pm_fix == 1 then delta = (1*120) end
if am_pm == 1 and godzina == 2 and am_pm_fix == 1 then delta = (2*120) end
if am_pm == 1 and godzina == 3 and am_pm_fix == 1 then delta = (3*120) end
if am_pm == 1 and godzina == 4 and am_pm_fix == 1 then delta = (4*120) end

for i=33,1,-1 do
  if string.find(kalendarz_astro, kalendarz_imp_dni_liczebniki[i]) then
    dzien=i+kalendarz_imp_delta_dni[miesiac]
    break
  end
end

for i=1,6,1 do
  if string.find(kalendarz_astro, kalendarz_imp_swieta_nazwydni[i]) then
    dzien=kalendarz_imp_swieta[i]
    break
  end
end

for i=1,16,1 do
  if dzien &lt;= kalendarz_imp_now[i] then
    now=kalendarz_imp_now[i]
    zachod=kalendarz_imp_zachod[i]
    break
  else
    now=kalendarz_imp_now[1]
    zachod=kalendarz_imp_zachod[1]
  end
end

for i=1,13,1 do
  if dzien &lt;= kalendarz_imp_pelnia[i] then
    pelnia=kalendarz_imp_pelnia[i]
    break
  else
    pelnia=kalendarz_imp_pelnia[1]
  end
end

for i=1,6,1 do
  if dzien &lt;= kalendarz_imp_swieta[i] then
    swieto=kalendarz_imp_swieta[i]
    swieto_nazwa=kalendarz_imp_swieta_nazwy[i]
    break
  else
    swieto=kalendarz_imp_swieta[1]
    swieto_nazwa=kalendarz_imp_swieta_nazwy[1]
  end
end

czas = getEpoch()

if now &gt;= dzien then
  now_delta = (now-dzien)*2880-delta+(zachod*120)
else
  now_delta = (400+kalendarz_imp_now[1]-dzien)*2880-delta+(zachod*120)
end

if pelnia &gt;= dzien then
  pelnia_delta = (pelnia-dzien)*2880-delta
else
  pelnia_delta = (400+kalendarz_imp_pelnia[1]-dzien)*2880-delta
end

if swieto &gt;= dzien then 
  swieto_delta = (swieto-dzien)*2880-delta
else
  swieto_delta = (400+kalendarz_imp_swieta[1]-dzien)*2880-delta
end

echo("Predykcje wydarzen astronomicznych wg kalendarza imperialnego:\n")
echo("==============================================================\n\n")

echo("Aktualny czas      : ")
print(os.date("%c", czas))
echo("\n")


echo("Najblizszy now     : ")
print(os.date("%c", czas+now_delta))
echo(" (czyli za okolo " .. convert_time(now_delta) .. " czasu RL)\n")
echo("Tego dnia zachod slonca o godzinie " .. zachod .. " czasu arkadyjskiego\n\n")

echo("Najblizsza pelnia  : ")
print(os.date("%c", czas+pelnia_delta))
echo(" (czyli za okolo " .. convert_time(pelnia_delta) .. " czasu RL)\n\n")

echo("Najblizsze swieto  : ")
print(os.date("%c", czas+swieto_delta))
echo(" (czyli za okolo " .. convert_time(swieto_delta) .. " czasu RL)\n")
echo("Swieto to : " .. swieto_nazwa .. "\n\n")

echo("==============================================================\n\n")

end

function predykcje_astro_ish()

local czas, delta, pelnia_delta, swieto_delta, festyn_delta
local dzien, miesiac, godzina, am_pm
local pelnia, swieto, swieto_nazwa, festyn
local am_pm_fix = 0
local poludnie_fix = 0

for i=1,8,1 do
  if string.find(kalendarz_astro, kalendarz_ish_miesiac_txt[i]) then
    miesiac = i
    break
  else
    if string.find(kalendarz_astro, kalendarz_ish_swieta_nazwy[i]) then
      miesiac = i
      break
    end
  end
end

for i=1,5,1 do
  if string.find(kalendarz_astro, kalendarz_am[i]) then
    am_pm = 0
    break
  end
end

if string.find(kalendarz_astro, kalendarz_am[5]) then
  godzina = 0
end

for i=1,5,1 do
  if string.find(kalendarz_astro, kalendarz_pm[i]) then
    am_pm = 1
    if i == 4 then am_pm_fix = 1 end
    if i == 5 then
      poludnie_fix = 1
      godzina = 12
      break
    end    
    break
  end
end

for i=1,12,1 do
  if string.find(kalendarz_astro, kalendarz_godzina[i]) then
    godzina = i
    break
  end
end

delta = 0

if am_pm == 0 then delta = godzina*120 end
if am_pm == 1 then delta = (godzina+12)*120 end

if am_pm == 1 and godzina == 12 then delta = 0 end
if am_pm == 1 and godzina == 12 and poludnie_fix == 1 then delta = (12*120) end
if am_pm == 1 and godzina == 1 and am_pm_fix == 1 then delta = (1*120) end
if am_pm == 1 and godzina == 2 and am_pm_fix == 1 then delta = (2*120) end
if am_pm == 1 and godzina == 3 and am_pm_fix == 1 then delta = (3*120) end
if am_pm == 1 and godzina == 4 and am_pm_fix == 1 then delta = (4*120) end

for i=45,1,-1 do
  if string.find(kalendarz_astro, kalendarz_ish_dni_liczebniki[i]) then
    dzien=i+kalendarz_ish_delta_dni[miesiac]
    break
    end
end

for i=1,8,1 do
  if string.find(kalendarz_astro, kalendarz_ish_swieta_nazwy[i]) then
    dzien=1+kalendarz_ish_delta_dni[miesiac]
    break
    end
end

for i=1,15,1 do
  if dzien &lt;= kalendarz_ish_pelnia[i] then
    pelnia=kalendarz_ish_pelnia[i]
    break
  else
    pelnia=kalendarz_ish_pelnia[1]
  end
end

for i=1,8,1 do
  if dzien &lt;= kalendarz_ish_swieta[i] then
    swieto=kalendarz_ish_swieta[i]
    swieto_nazwa=kalendarz_ish_swieta_nazwy[i]
    break
  else
    swieto=kalendarz_ish_swieta[1]
    swieto_nazwa=kalendarz_ish_swieta_nazwy[1]
  end
end

czas = getEpoch()

if pelnia &gt;= dzien then
  pelnia_delta = (pelnia-dzien)*2880-delta
else
  pelnia_delta = (360+kalendarz_ish_pelnia[1]-dzien)*2880-delta
end

if swieto &gt;= dzien then 
  swieto_delta = (swieto-dzien)*2880-delta
else
  swieto_delta = (360+kalendarz_ish_swieta[1]-dzien)*2880-delta
end

for i=1,8,1 do
  if dzien &lt;= (kalendarz_ish_festyn[i]+2) then
    festyn = kalendarz_ish_festyn[i]
    break
  else
    festyn = kalendarz_ish_festyn[1]
  end
end

if festyn &gt;= dzien then 
  festyn_delta = (festyn-dzien)*2880-delta
else
  festyn_delta = (360+kalendarz_ish_festyn[1]-dzien)*2880-delta
end

if dzien &lt;= (festyn+2) then
  festyn_delta = (festyn-dzien)*2880-delta
end

echo("Predykcje wydarzen astronomicznych wg kalendarza Starszego Ludu:\n")
echo("================================================================\n\n")

echo("Aktualny czas      : ")
print(os.date("%c", czas))
echo("\n")

echo("Poczatek najblizszej pelni  : ")
print(os.date("%c", czas+pelnia_delta))
echo(" (czyli za okolo " .. convert_time(pelnia_delta) .. " czasu RL)\n\n")

echo("Koniec najblizszej pelni  : ")
print(os.date("%c", czas+pelnia_delta+5760))
echo(" (czyli za okolo " .. convert_time(pelnia_delta+5760) .. " czasu RL)\n\n")

echo("Najblizsze swieto  : ")
print(os.date("%c", czas+swieto_delta))
echo(" (czyli za okolo " .. convert_time(swieto_delta) .. " czasu RL)\n")
echo("Swieto to : " .. swieto_nazwa .. "\n\n")

echo("Festyn w Eysenlaan\n")
echo("Rozpoczecie festynu  : ")
print(os.date("%c", czas+festyn_delta))
echo(" (czyli za okolo " .. convert_time(festyn_delta) .. " czasu RL)\n")
echo("Zakonczenie festynu  : ")
print(os.date("%c", czas+festyn_delta+8640))
echo(" (czyli za okolo " .. convert_time(festyn_delta+8640) .. " czasu RL)\n")


echo("================================================================\n\n")

end

function predykcje_astro()



if kalendarz_astro then
  if kalendarz_imp_ish == 0 then
    predykcje_astro_ish()
  else
    predykcje_astro_imp()
  end
else
  echo("Wyjdz na zewnatrz i sprawdz czas...\n")
end

end</script>
			<eventHandlerList />
		</Script>
	</ScriptPackage>
</MudletPackage>
